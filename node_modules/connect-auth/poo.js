var fbId= "113560732012113";
var fbSecret= "f53a25cf96e19743fdcd189307bf47ac";
var fbCallbackAddress= "http://www.ciaranj.me/auth/facebook_callback"

var cookieSecret = "xxxxxxx";     // enter a random hash for security

var express= require('express');
var auth= require('./lib')
var app = express.createServer();

app.configure(function(){
  app.use(express.cookieParser());
  app.use(express.session({secret: cookieSecret}));
  app.use(auth({trace:true,strategies: [
    auth.Facebook({appId : fbId, appSecret: fbSecret, scope: "email", callback: fbCallbackAddress})
  ]}) );
});

// Method to handle a sign-in with a specified method type, and a url to go back to ...
app.get('/signin', function(req,res) {
  req.authenticate(function(error, authenticated) { 
    if(authenticated ) {
      res.end("<html><h1>Hello Facebook user:" + JSON.stringify( req.getAuthDetails() ) + ".</h1></html>")
    }
    else {
      res.end("<html><h1>Facebook authentication failed :( </h1></html>")
    }
   });
});

// Route for some arbirtrary page, that contains a sign-in link
app.get('/somepage', function(req, res){
  var sign_in_link= "/signin?method=facebook&redirectUrl=" + escape(req.url);
  if( req.isAuthenticated() ) {
    res.end('<html><body><h1>Signed in with Facebook</h1></body></html>')
  }
  else {
    res.end('<html><body><a href="'+ sign_in_link + '">Sign in with Facebook</a></body></html>')
  }
});
app.listen(80);